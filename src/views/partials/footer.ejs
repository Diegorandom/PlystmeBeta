<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
    integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">



<link rel="stylesheet" href="/style/icon.css">
<link rel="stylesheet" href="/style/idangerous.swiper.css">
<link rel="stylesheet" href="/style/magnific.css">

<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<link rel="stylesheet" type="text/css" href="/style/stylesheet.css" />


<!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">-->


<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>

<link href='https://fonts.googleapis.com/css?family=Josefin+Slab' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

<!-- SCRIPTS	 -->

<script src="/script/idangerous.swiper.min.js"></script>
<script src="/script/isotope.pkgd.min.js"></script>
<script src="/script/jquery.viewportchecker.min.js"></script>
<script src="/script/magnific.js"></script>
<script src="/script/global.js"></script>
<script src="/script/colors.js"></script>
<script src="/script/filters.js"></script>
<script src="/script/jqColorPicker.js"></script>
<script src="/script/jquery-ui.min.js"></script>
<script src="/script/jquery.countTo.js"></script>

<script>
    /*Script para análisis de Google*/
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-100555275-1', 'auto');
    ga('send', 'pageview');



</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115050824-3"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-115050824-3');
</script>


<script>
    /*Trackeo de actividad del usuario*/
    var timeoutID;

    function setup() {
        this.addEventListener("mousemove", resetTimer, false);
        this.addEventListener("mousedown", resetTimer, false);
        this.addEventListener("keypress", resetTimer, false);
        this.addEventListener("DOMMouseScroll", resetTimer, false);
        this.addEventListener("mousewheel", resetTimer, false);
        this.addEventListener("touchmove", resetTimer, false);
        this.addEventListener("MSPointerMove", resetTimer, false);
        /*Se detona Timer que checa si el usuario se queda en la pantalla sin hacer nada*/
        startTimer();
    }
    /*Inicia trackeo de actividad*/
    setup();

    /*Timer que espera por 4 horas si el usuario deja la pantalla encendida sin mover nada. En caso de que se termine el timer se activa goInactive*/
    function startTimer() {
        timeoutID = window.setTimeout(goInactive, 1000 * 60 * 60 * 40);
    }

    /*Se resetea el timer y empieza de nuevo*/
    function resetTimer(e) {
        window.clearTimeout(timeoutID);

        goActive();
    }

    /*Se borran los datos del RAM del sistema*/
    function goInactive() {
        // do something
        console.log('INACTIVE')
        $.get('/idle', function (data, success) {
            if (success) {
                window.location.replace('/');
            }
        });
    }

    /*Detona el timer para irse a idle*/
    function goActive() {
        // do something
        startTimer();
    }

    var timer2;

    /*Timer que se detona cada hora para checar que el usuario sigue conectado con el sistema*/
    function startTimer2() {
        timer2 = window.setTimeout(heartbeat, 1000 * 60 * 60 * 1)
    }

    /*Heartbeat manda una señal para evitar que el sistema depure los datos del usuarios. En caso de que no haya actividad por 4 horas, el usuario sale del sistema automaticamente*/
    function heartbeat() {
        $.get('/heartbeat', function (data, success) {
            if (success == true) {
                console.log(data)
            }
        })
        startTimer2();
    }

    /*Comienza timer de heartbeat*/
    startTimer2();

</script>